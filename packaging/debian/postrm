#!/bin/bash
# postrm script for vacuum-controller
# This script runs after package removal

set -e

case "$1" in
    purge)
        # Remove configuration files and data
        rm -rf /etc/vacuum-controller
        rm -rf /var/lib/vacuum-controller
        rm -rf /var/log/vacuum-controller

        # Remove udev rules
        rm -f /etc/udev/rules.d/99-vacuum-controller.rules
        udevadm control --reload-rules
        udevadm trigger

        # Remove desktop entry
        rm -f /usr/share/applications/vacuum-controller.desktop

        # Remove systemd service file
        rm -f /lib/systemd/system/vacuum-controller.service
        if [ -d /run/systemd/system ]; then
            systemctl daemon-reload
        fi

        # Remove vacuum-controller user
        if id "vacuum-controller" &>/dev/null; then
            userdel vacuum-controller 2>/dev/null || true
        fi

        echo "Vacuum Controller completely removed from system."
        ;;

    remove|upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
        # Don't remove user data on regular removal
        ;;

    *)
        echo "postrm called with unknown argument \`$1'" >&2
        exit 1
        ;;
esac

exit 0
